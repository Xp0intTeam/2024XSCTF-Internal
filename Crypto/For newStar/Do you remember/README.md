* **题目名称：** Do you remember

* **题目类型：** CRYPTO
* **题目难度：** (中等)

* **出题人：** HvAng

* **考点：**  

1. 数列错位相减
2. 费马小定理

* **描述：**  当数列遇上数论，会碰撞出什么样的火花呢？

* **flag：** XSCTF{0oOh!!!!Y0u_5ti1l_4eM3mBer_It!!!!}

* **Writeup：**

$先求s，推导过程中，让人梦回高中数列$
$为方便书写，以下操作均在Z_{p}^{*}中进行$

$A=p*s^{p}+(p-1)*s^{p-1}+(p-2)*s^{p-2}+...+3*s^{3}+2*s^{2}+s$

$熟悉吧，这里我们运用数列的错位相减法$

$sA=p*s^{p+1}+(p-1)*s^{p}+(p-2)*s^{p-1}+...+3*s^{4}+2*s^{3}+s^{2}$

$A-sA=-p*s^{p+1}+s^{p}+s^{p-1}+...+s^{2}+s=s^{p}+s^{p-1}+...+s^{2}+s=s*(1-s^{p})/(1-s)$

$A(1-s)^{2}=s*(1-s^{p})=s-s^{2}，费马小定理(s^{p}\equiv s(mod\ p))$

$s\not =1，A(1-s)=s$

$s(1+A)=A$

$s=A*(A+1)^{-1}$

`return iv + cipher.encrypt(m)`，注意这段代码，需要把`iv`(前16字节)和`ciphertext`给分离出来
最后解`AES`即可得到`flag`

```py
from Crypto.Util.number import *
from Crypto.Cipher import AES
from hashlib import md5
p = 150047847443555551780607383646778335047016817274774459455572118295420220872760843861826572060713763782515891193340180392530495643801084940512366868263554252383596890003894873239311420889498780869512686734074664111786688233786779976225149167699060122695390892886742071588757965095218555236842615070938584224951
A = 51614072930641858258532588732222609622897694793167241294993244884925210558134005443237467321313043942962515267570552991785563189473033043886024990814406068205757425516773042625353457364709443923481317059018116482598994297758122636917351167174984692517164422735383776677374199361980133930130563590387131095237
iv_cip = long_to_bytes(
    0x83fe4228a3f69df5593e024d00478474115c2fed979508756f6cdc4d88d834afd473c22c9585c147513e0d97097a803c15e85b92f4d35651c1721ce623bfc97b)
ciphertext = iv_cip[16:]
iv = iv_cip[:16]
s = inverse(A+1, p)*A % p
key = long_to_bytes(s)
key = md5(key).digest()
cipher = AES.new(key, AES.MODE_CBC, iv=iv)
print(cipher.decrypt(ciphertext))
```